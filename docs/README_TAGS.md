# Система тегов для изображений

Этот документ описывает новую функциональность тегирования изображений, добавленную в приложение.

## Что добавлено

### 1. База данных
- **Таблица `tags`** - хранит все доступные теги с их названиями и цветами
- **Таблица `images`** - хранит метаданные загруженных изображений
- **Таблица `image_tags`** - связующая таблица для связи изображений с тегами (many-to-many)

### 2. Компоненты
- **TagSelector** - компонент для выбора и создания тегов
- **Обновленный FileUpload** - теперь позволяет выбирать теги при загрузке
- **Обновленный FileView** - отображает теги для каждого изображения

### 3. Функциональность
- Выбор существующих тегов при загрузке изображения
- Создание новых тегов "на лету"
- Отображение тегов в галерее изображений
- Автоматическое удаление связей при удалении изображений
- Цветовая индикация тегов

## Установка

### 1. Применение миграции базы данных

Выполните SQL-скрипт из файла `migrations/create_image_tags_tables.sql` в вашей базе данных Supabase:

```sql
-- Скопируйте и выполните содержимое файла migrations/create_image_tags_tables.sql
```

### 2. Обновление типов TypeScript

Типы уже обновлены в файле `lib/types.ts`. Если вы используете автогенерацию типов Supabase, обновите их:

```bash
npx supabase gen types typescript --project-id YOUR_PROJECT_ID > lib/database.types.ts
```

## Использование

### Загрузка изображения с тегами

1. Выберите изображение для загрузки
2. Появится селектор тегов
3. Выберите существующие теги или создайте новые
4. Нажмите "Загрузить изображение"

### Создание нового тега

1. В селекторе тегов нажмите "Создать новый тег"
2. Введите название тега
3. Нажмите "Создать" или Enter
4. Тег автоматически добавится к изображению

### Просмотр тегов

Теги отображаются в нижней части каждого изображения в галерее с соответствующими цветами.

## Структура базы данных

### Таблица `tags`
```sql
- id: UUID (Primary Key)
- name: VARCHAR(50) UNIQUE
- color: VARCHAR(7) (hex цвет)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

### Таблица `images`
```sql
- id: UUID (Primary Key)
- user_id: UUID (Foreign Key to auth.users)
- file_name: VARCHAR(255)
- file_path: VARCHAR(500)
- file_size: INTEGER
- mime_type: VARCHAR(100)
- public_url: TEXT
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

### Таблица `image_tags`
```sql
- id: UUID (Primary Key)
- image_id: UUID (Foreign Key to images)
- tag_id: UUID (Foreign Key to tags)
- created_at: TIMESTAMP
```

## Безопасность

Настроены политики Row Level Security (RLS):

- **Теги**: доступны для чтения всем, создавать могут только авторизованные пользователи
- **Изображения**: пользователи видят только свои изображения
- **Связи тегов**: доступ только к тегам собственных изображений

## Предустановленные теги

При применении миграции автоматически создаются базовые теги:
- природа (зеленый)
- портрет (оранжевый)
- архитектура (синий)
- еда (красный)
- животные (фиолетовый)
- путешествия (голубой)
- спорт (оранжевый)
- искусство (розовый)
- технологии (серый)
- семья (лайм)

## Технические детails

### Компоненты

**TagSelector.tsx**
- Загрузка доступных тегов
- Создание новых тегов
- Управление выбранными тегами
- Адаптивный дизайн

**FileUpload.tsx**
- Интеграция с TagSelector
- Сохранение метаданных изображения
- Связывание изображения с тегами

**FileView.tsx**
- Загрузка изображений с тегами
- Отображение тегов
- Удаление изображений и связанных данных

### Стили

Все стили находятся в:
- `app/components/bucket/TagSelector.css`
- `app/components/components.css` (стили для отображения тегов в галерее)

## Поиск изображений

Добавлена функциональность поиска изображений на странице `/search`:

### Возможности поиска:
- **Поиск по названию файла** - введите часть названия файла для поиска
- **Фильтрация по тегам** - выберите один или несколько тегов для фильтрации
- **Комбинированный поиск** - используйте название файла и теги одновременно
- **Визуальное отображение** - результаты показываются в виде галереи с тегами

### Компоненты поиска:
- **ImageSearchComponent** - компонент для поиска изображений пользователя
- **Обновленная страница поиска** - теперь содержит вкладки для поиска по блогу и изображениям

## Возможные улучшения

1. ✅ **Фильтрация по тегам** - реализовано в поиске изображений
2. **Поиск тегов** - поиск среди большого количества тегов
3. **Статистика тегов** - показать количество использований каждого тега
4. **Массовое тегирование** - добавление тегов к нескольким изображениям сразу
5. **Экспорт/импорт тегов** - для переноса между проектами
6. **Полнотекстовый поиск** - поиск по описаниям изображений
7. **Сортировка результатов** - по дате, названию, количеству тегов
