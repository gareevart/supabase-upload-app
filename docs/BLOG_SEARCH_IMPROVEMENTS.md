# Улучшения компонента поиска на странице блога

## Обзор

Реализованы улучшения UX для компонента поиска на странице `/blog`, которые обеспечивают более фокусированный и удобный опыт поиска.

## Реализованные функции

### 1. Плавное расширение поля поиска

При клике на строку поиска (фокусе) поле ввода плавно расширяется на всю ширину своей строки с использованием:
- CSS transitions с кубической кривой Безье для плавной анимации
- Абсолютное позиционирование для расширения на всю ширину родительского контейнера
- Двухэтапная анимация для более плавного UX

### 2. Последовательное скрытие элементов управления

Анимация происходит в два этапа:

**Этап 1 (при фокусе):**
1. Сначала скрываются контролы справа (300ms)
2. Затем поле поиска плавно расширяется на освободившееся место

**Этап 2 (при потере фокуса):**
1. Сначала поле поиска сужается обратно (300ms)
2. Затем появляются контролы справа **только если поле поиска пустое**
3. Если в поле есть текст, контролы остаются скрытыми для сохранения места под результаты поиска

Элементы, которые скрываются:
- **Select** с выбором типа постов (Все / Опубликованные / Черновики)
- **SegmentedRadioGroup** с переключением вида карточек (Grid / List)

Скрытие происходит плавно с помощью:
- CSS transitions для opacity, transform и width
- `pointer-events: none` для предотвращения взаимодействия со скрытыми элементами
- Небольшой сдвиг по оси X для более естественной анимации
- `overflow: hidden` для плавного сжатия ширины

### 3. Управление состоянием фокуса

Добавлена логика управления состоянием фокуса:
- Два независимых state: `searchFocused` (для расширения поля) и `controlsHidden` (для скрытия контролов)
- Callback `onFocusChange` для передачи состояния фокуса от `SearchComponent` к родительскому компоненту
- Последовательные `setTimeout` для создания двухэтапной анимации (300ms между этапами)
- Задержка в 200ms при `blur` в SearchComponent для возможности клика на результаты поиска

### 4. Умное управление видимостью контролов

Контролы (Select и SegmentedRadioGroup) остаются скрытыми, пока есть текст в поле поиска:
- При вводе текста контролы автоматически скрываются
- При очистке поля (без фокуса) контролы появляются обратно
- При потере фокуса контролы появляются только если поле пустое
- Это обеспечивает больше места для отображения результатов поиска

### 5. Единообразный дизайн карточек

Результаты поиска теперь используют тот же компонент карточки, что и страница блога:
- Создан переиспользуемый компонент `BlogPostCard` в `shared/ui`
- Карточки поиска идентичны карточкам в режиме списка на странице блога
- Мобильная версия использует ту же карточку, что и в статьях
- Поддержка отображения контекста поиска с подсветкой найденного текста
- Следует принципам FSD (Feature-Sliced Design)

## Технические детали

### Изменённые файлы

1. **shared/ui/BlogPostCard.tsx** (новый файл)
   - Переиспользуемый компонент карточки блога
   - Поддержка режимов grid/list
   - Опциональное отображение кнопки "Read"
   - Поддержка контекста поиска с подсветкой
   - Единый интерфейс `BlogPost` для типизации

2. **app/blog/page.tsx**
   - Добавлен state `searchFocused` и `controlsHidden`
   - Добавлен handler `handleSearchFocus` с последовательной анимацией
   - Обновлён `SearchComponent` с пропсами `onFocusChange` и `expandOnFocus`
   - Добавлена анимация скрытия для контролов фильтрации и переключения вида
   - Умное управление видимостью контролов на основе содержимого поиска

3. **app/components/SearchComponent.tsx**
   - Добавлены новые пропсы: `onFocusChange` и `expandOnFocus`
   - Добавлен state `isFocused` и hook `useIsMobile`
   - Реализованы handlers `handleFocus` и `handleBlur`
   - Обновлён интерфейс `SearchComponentProps` (экспортирован)
   - Добавлен класс `expanded` для CSS-анимации
   - Интегрирован компонент `BlogPostCard` для отображения результатов
   - Обновлены скелетоны загрузки в стиле карточек блога

4. **app/components/components.css**
   - Добавлены стили для `.search-container.expanded`
   - Реализована плавная transition с cubic-bezier
   - Добавлена тень для визуального разделения
   - Responsive padding для мобильных устройств

## Принципы дизайна

### FSD подход
Изменения следуют Feature-Sliced Design архитектуре:
- Логика разделена между представлением (page.tsx) и компонентом (SearchComponent.tsx)
- Состояние управляется на правильном уровне абстракции
- CSS стили изолированы и переиспользуемы

### Gravity UI
Используется дизайн-система Gravity UI:
- Цвета через CSS переменные (`--g-color-base-background`)
- Компоненты Gravity UI (TextInput, Icon, etc.)
- Соблюдение паттернов дизайн-системы

### UX улучшения
- Плавные анимации с `cubic-bezier(0.4, 0, 0.2, 1)` для естественного движения
- Прозрачная обратная связь при переключении состояний
- Минимальная задержка в 200ms для предотвращения случайного закрытия
- Адаптивность для различных размеров экрана

## Использование

```tsx
<SearchComponent
  placeholder="Поиск по блогу..."
  onResultClick={handleSearchResultClick}
  onUpdate={handleSearchQueryChange}
  onFocusChange={handleSearchFocus}
  expandOnFocus={true}
/>
```

## Параметры

- `expandOnFocus` (boolean, default: false) - включает режим расширения на весь экран при фокусе
- `onFocusChange` (callback) - вызывается при изменении состояния фокуса с параметром `focused: boolean`

## Совместимость

- ✅ Десктоп браузеры
- ✅ Мобильные устройства (адаптивный padding)
- ✅ Темная/светлая тема (через CSS переменные Gravity UI)
- ✅ Работает с существующими функциями поиска

## Производительность

- Использование CSS transitions вместо JavaScript анимаций
- Минимальное количество re-renders благодаря правильному управлению состоянием
- Hardware acceleration через CSS transforms
- Debounced поиск (500ms) предотвращает избыточные запросы

## Возможные улучшения

1. Добавить кнопку "Закрыть" в расширенном режиме поиска
2. Реализовать overlay с затемнением фона при расширении поиска
3. Добавить горячие клавиши (например, Escape для закрытия)
4. Сохранять состояние поиска в URL параметрах
5. Добавить анимацию для результатов поиска (fade in/out)

## Тестирование

Для тестирования функциональности:

1. Откройте страницу `/blog`
2. Кликните на поле поиска
3. Убедитесь, что:
   - Поле плавно расширяется на весь экран
   - Select и SegmentedRadioGroup плавно исчезают
   - Можно взаимодействовать с результатами поиска
   - При потере фокуса всё возвращается в исходное состояние

