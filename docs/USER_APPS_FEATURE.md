# Функционал создания пользовательских TypeScript приложений

## Обзор

Новая функция позволяет пользователям создавать, редактировать и запускать TypeScript приложения прямо в браузере на странице профиля. Приложения выполняются в изолированной среде и могут быть как приватными, так и публичными.

## Основные возможности

### 1. Создание приложений
- **Название и описание**: Пользователи могут задать название и описание своего приложения
- **Иконка**: Загрузка иконки размером 512x512px
- **Приватность**: Возможность сделать приложение публичным или приватным

### 2. Редактор кода
- **Monaco Editor**: Полнофункциональный редактор с подсветкой синтаксиса TypeScript
- **IntelliSense**: Автодополнение и проверка типов
- **Вкладки**: Отдельные вкладки для TypeScript, HTML и CSS кода
- **Настройки**: Темная/светлая тема, размер шрифта, автоформатирование

### 3. Выполнение кода
- **Мгновенный запуск**: Код компилируется и выполняется в iframe
- **Изоляция**: Безопасное выполнение в изолированной среде
- **Консоль**: Отображение console.log, ошибок и предупреждений
- **Горячая перезагрузка**: Возможность перезапуска без потери состояния

### 4. AI Ассистент
- **Генерация кода**: Создание TypeScript кода по текстовому описанию
- **Интеграция с чатами**: Импорт кода из существующих чатов
- **Умные подсказки**: AI помогает с исправлением ошибок и оптимизацией

### 5. Управление приложениями
- **Список приложений**: Красивая сетка с превью кода и метаданными
- **Поиск и фильтрация**: Быстрый поиск по названию и описанию
- **Публичные ссылки**: Возможность поделиться приложением через публичную ссылку

## Техническая архитектура

### База данных
```sql
-- Таблица пользовательских приложений
CREATE TABLE user_apps (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  name VARCHAR(255) NOT NULL,
  description TEXT,
  icon_url TEXT,
  code TEXT NOT NULL,
  html_template TEXT,
  css_styles TEXT,
  is_public BOOLEAN DEFAULT false,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### API Endpoints
- `GET /api/user-apps` - Получить список приложений пользователя
- `POST /api/user-apps` - Создать новое приложение
- `GET /api/user-apps/[id]` - Получить конкретное приложение
- `PUT /api/user-apps/[id]` - Обновить приложение
- `DELETE /api/user-apps/[id]` - Удалить приложение (soft delete)
- `GET /api/user-apps/[id]/public` - Публичный доступ к приложению

### Компоненты
- `AppManager` - Основной компонент управления приложениями
- `AppEditor` - Редактор для создания/редактирования приложений
- `CodeEditor` - Monaco Editor для написания кода
- `AppRunner` - Компонент для выполнения кода в iframe
- `AppList` - Список приложений с превью

### Хуки
- `useCodeGeneration` - Интеграция с AI для генерации кода
- `useChatImport` - Импорт кода из чатов

## Безопасность

### Изоляция кода
- Код выполняется в iframe с ограниченными правами
- Sandbox атрибуты предотвращают доступ к родительскому окну
- Нет доступа к cookies и localStorage основного сайта

### Валидация
- Проверка размера кода (максимум 50KB)
- Фильтрация потенциально опасных API
- Rate limiting для API запросов

### Права доступа
- Row Level Security (RLS) в Supabase
- Пользователи видят только свои приложения
- Публичные приложения доступны всем без аутентификации

## Использование

### Создание приложения
1. Перейти на страницу профиля (`/profile`)
2. Нажать "Создать приложение"
3. Заполнить название и описание
4. Написать TypeScript код в редакторе
5. Протестировать в предварительном просмотре
6. Сохранить приложение

### Использование AI ассистента
1. В редакторе нажать на вкладку "AI Ассистент"
2. Описать желаемую функциональность
3. Нажать "Сгенерировать код"
4. Код автоматически вставится в редактор

### Публикация приложения
1. В настройках приложения включить "Публичное приложение"
2. Сохранить изменения
3. Скопировать публичную ссылку из списка приложений
4. Поделиться ссылкой с другими пользователями

## Примеры приложений

### Простое приложение
```typescript
// Создаем приветствие
function greet(name: string): string {
  return `Привет, ${name}!`;
}

const app = document.getElementById('root');
if (app) {
  app.innerHTML = `
    <div style="text-align: center; padding: 20px;">
      <h1>${greet('Мир')}</h1>
      <button onclick="alert('Привет!')">Нажми меня</button>
    </div>
  `;
}
```

### Интерактивное приложение
```typescript
// Счетчик кликов
let count = 0;

function updateCounter() {
  const counter = document.getElementById('counter');
  if (counter) {
    counter.textContent = count.toString();
  }
}

function increment() {
  count++;
  updateCounter();
}

const app = document.getElementById('root');
if (app) {
  app.innerHTML = `
    <div style="text-align: center; padding: 20px;">
      <h1>Счетчик: <span id="counter">0</span></h1>
      <button onclick="increment()">+1</button>
    </div>
  `;
}
```

## Ограничения

### Текущие ограничения
- Нет поддержки npm пакетов (только встроенные API браузера)
- Максимальный размер кода: 50KB
- Нет поддержки WebAssembly
- Ограниченный доступ к внешним API (CORS)

### Планируемые улучшения
- Поддержка популярных библиотек (React, Vue, etc.)
- Система шаблонов для быстрого старта
- Возможность экспорта приложений
- Интеграция с GitHub для версионирования
- Marketplace для публичных приложений

## Миграция

Для активации функционала необходимо выполнить миграцию:

```bash
# Применить миграцию в Supabase
supabase db push
```

Или выполнить SQL из файла `migrations/create_user_apps_table.sql` в Supabase Dashboard.
