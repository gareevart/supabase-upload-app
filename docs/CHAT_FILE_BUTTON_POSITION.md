# Изменение расположения кнопки добавления файлов

## Дата: 10 октября 2025

## Описание изменения

Кнопка добавления файлов перемещена из отдельной секции в панель инструментов (`toolbar`) формы чата, рядом с другими кнопками управления.

## Новое расположение

### Порядок кнопок в toolbar (слева направо):
1. **📤 Кнопка прикрепления файлов** - всегда видна
2. **⚙️ Кнопка режима рассуждений** - только для YandexGPT
3. **↩️ Кнопка отправки** - всегда видна

## Визуальная структура

### До изменения:
```
┌─────────────────────────────────────────┐
│ FileUploader (отдельная секция)        │
│ [📤] [список файлов]                    │
├─────────────────────────────────────────┤
│ [Текстовое поле]  [⚙️] [↩️]             │
└─────────────────────────────────────────┘
```

### После изменения:
```
┌─────────────────────────────────────────┐
│ [список прикреплённых файлов]          │  ← Показывается только если есть файлы
├─────────────────────────────────────────┤
│ [Текстовое поле]  [📤] [⚙️] [↩️]        │
└─────────────────────────────────────────┘
           ↑        ↑    ↑    ↑
         Textarea  File Rsn Send
```

## Реализация

### Два режима FileUploader

Компонент `FileUploader` теперь поддерживает два режима работы:

#### 1. Компактный режим (`compact={true}`)
- Отображается только кнопка 📤
- Используется в toolbar
- Не показывает список файлов

```tsx
<FileUploader
  onFilesChange={setAttachedFiles}
  compact={true}  // ← Компактный режим
  maxFiles={3}
/>
```

#### 2. Полный режим (`compact={false}`)
- Отображается список прикреплённых файлов
- Показывает превью и информацию о файлах
- Кнопки удаления для каждого файла
- Используется над textarea когда есть файлы

```tsx
{attachedFiles.length > 0 && (
  <FileUploader
    onFilesChange={setAttachedFiles}
    compact={false}  // ← Полный режим
    maxFiles={3}
  />
)}
```

## Изменённые файлы

### 1. `FileUploader.tsx`
**Добавлено:**
- Новый prop `compact?: boolean`
- Условный рендеринг для компактного режима
- Возврат только кнопки в компактном режиме

```typescript
interface FileUploaderProps {
  // ... existing props
  compact?: boolean; // НОВОЕ
}

// В компактном режиме возвращаем только кнопку
if (compact) {
  return (
    <>
      <input ref={fileInputRef} type="file" ... />
      <Button onClick={handleButtonClick}>
        <Icon data={FileArrowUp} />
      </Button>
    </>
  );
}
```

### 2. `ChatMessageForm.tsx`
**Изменено:**
- Список файлов показывается отдельно над textarea
- Кнопка файлов добавлена в toolbar в компактном режиме
- Порядок кнопок: File → Reasoning → Send

```tsx
{/* Список файлов - только если есть */}
{attachedFiles.length > 0 && (
  <div className="chat-message-form__files-list">
    <FileUploader compact={false} ... />
  </div>
)}

{/* Toolbar с кнопками */}
<div className="chat-message-form__toolbar">
  <FileUploader compact={true} ... />  {/* Кнопка */}
  {selectedModel === 'yandexgpt' && <Button>...</Button>}
  <Button type="submit">...</Button>
</div>
```

### 3. `FileUploader.css`
**Добавлено:**
```css
.file-uploader__compact-button {
  flex-shrink: 0;
}
```

### 4. `ChatMessageForm.css`
**Обновлено:**
```css
.chat-message-form__files-list {
  margin-bottom: 8px;
}
```

## Преимущества нового расположения

### UX улучшения:
1. ✅ **Логичная группировка** - все кнопки управления в одном месте
2. ✅ **Меньше визуального шума** - кнопка не занимает отдельную секцию
3. ✅ **Быстрый доступ** - кнопка всегда на виду в toolbar
4. ✅ **Единообразие** - следует паттерну других мессенджеров

### Визуальные улучшения:
1. ✅ Более компактный интерфейс
2. ✅ Список файлов показывается только когда нужно
3. ✅ Кнопки выровнены и визуально связаны
4. ✅ Меньше пустого пространства

## Поведение

### Без прикреплённых файлов:
```
┌─────────────────────────────────────┐
│ [Текстовое поле]  [📤] [⚙️] [↩️]    │
└─────────────────────────────────────┘
```

### С прикреплёнными файлами:
```
┌─────────────────────────────────────┐
│ 🖼️ image.png (2.5 MB)      [❌]    │
│ 📄 document.pdf (1.2 MB)   [❌]    │
├─────────────────────────────────────┤
│ [Текстовое поле]  [📤] [⚙️] [↩️]    │
└─────────────────────────────────────┘
```

### При наведении на кнопку:
- Tooltip: "Прикрепить файл"
- Hover эффект согласно Gravity UI

## Совместимость

### Модели AI:
- **YandexGPT:** Кнопки: [📤] [⚙️] [↩️]
- **YandexGPT Lite:** Кнопки: [📤] [⚙️] [↩️]
- **Deepseek R1:** Кнопки: [📤] [↩️] (без режима рассуждений)
- **Другие:** Кнопки: [📤] [↩️]

### Устройства:
- ✅ Desktop - полная функциональность
- ✅ Tablet - адаптивное отображение
- ✅ Mobile - компактные кнопки

## Тестирование

### Проверьте:
1. ✅ Кнопка 📤 отображается в toolbar
2. ✅ Кнопка слева от режима рассуждений (если доступен)
3. ✅ Кнопка слева от кнопки отправки (если режим недоступен)
4. ✅ При клике открывается выбор файлов
5. ✅ После выбора файла появляется список файлов над textarea
6. ✅ Список файлов скрывается после отправки
7. ✅ Можно удалить файл из списка
8. ✅ Tooltip появляется при наведении

### Сценарии:
```
Тест 1: Базовый функционал
- Открыть чат
- Увидеть кнопку 📤 в toolbar
- Кликнуть на кнопку
- Выбрать файл
- Увидеть список файлов над textarea
- Отправить сообщение
- Список файлов скрылся

Тест 2: Порядок кнопок (YandexGPT)
- Выбрать модель YandexGPT
- Порядок: [📤] [⚙️] [↩️]
- Все кнопки кликабельны

Тест 3: Порядок кнопок (без рассуждений)
- Выбрать модель Deepseek
- Порядок: [📤] [↩️]
- Режим рассуждений скрыт

Тест 4: Мобильная версия
- Открыть на мобильном
- Кнопки компактные и доступные
- Touch события работают
```

## Обратная связь

При возникновении проблем проверьте:
1. Версия компонента FileUploader (должен поддерживать prop `compact`)
2. CSS стили загружены
3. Правильная последовательность кнопок в toolbar
4. События onClick работают корректно

## Заключение

Изменение расположения кнопки добавления файлов улучшает UX и делает интерфейс более интуитивным и компактным. Кнопка теперь логически сгруппирована с другими инструментами управления сообщением.

### Ключевые изменения:
- ✅ Кнопка перемещена в toolbar
- ✅ Добавлен компактный режим FileUploader
- ✅ Список файлов показывается отдельно
- ✅ Улучшен UX и визуальная иерархия

